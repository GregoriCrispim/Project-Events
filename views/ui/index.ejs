<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= appName %> • API Playground</title>
    <meta name="color-scheme" content="dark light" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="/public/ui.css" rel="stylesheet" />
  </head>
  <body>
    <header class="topbar">
      <div class="container-xl py-4">
        <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap">
          <div class="d-flex align-items-center gap-3">
            <div class="brand-mark">
              <i class="bi bi-stars"></i>
            </div>
            <div>
              <div class="h5 mb-0 text-white">API Playground</div>
              <div class="text-white-50 small">Teste sua API sem Postman • <span class="mono"><%= apiBaseHint %></span></div>
            </div>
          </div>

          <div class="d-flex align-items-center gap-2">
            <a class="btn btn-glass" href="/" title="Voltar para a raiz">
              <i class="bi bi-house-door"></i>
              <span class="d-none d-sm-inline">Home</span>
            </a>
            <a class="btn btn-glass" href="/eventos" target="_blank" rel="noreferrer">
              <i class="bi bi-box-arrow-up-right"></i>
              <span class="d-none d-sm-inline">Abrir /eventos</span>
            </a>
          </div>
        </div>
      </div>
    </header>

    <main class="container-xl pb-5">
      <div class="row g-4 mt-1">
        <div class="col-12 col-lg-4">
          <div class="card card-glass">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h6 class="mb-0">Conexão & Token</h6>
                <span class="badge badge-soft" id="connBadge">Pronto</span>
              </div>
              <div class="mt-3">
                <label class="form-label small text-white-50">Base URL</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                  <input id="baseUrl" class="form-control mono" type="text" placeholder="http://localhost:3000" />
                  <button class="btn btn-outline-light" id="saveBaseUrl" type="button">Salvar</button>
                </div>
                <div class="form-text text-white-50">Dica: em produção/Railway, use a URL pública do serviço.</div>
              </div>

              <hr class="hr-soft my-4" />

              <div class="d-flex align-items-center justify-content-between">
                <h6 class="mb-0">Login (JWT)</h6>
                <span class="small text-white-50">POST <span class="mono">/auth/login</span></span>
              </div>
              <div class="mt-3">
                <label class="form-label small text-white-50">Email (qualquer)</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-envelope"></i></span>
                  <input id="loginEmail" class="form-control" type="email" placeholder="voce@exemplo.com" />
                  <button class="btn btn-primary" id="btnLogin" type="button">
                    <i class="bi bi-shield-lock"></i>
                    Entrar
                  </button>
                </div>
              </div>

              <div class="mt-3">
                <label class="form-label small text-white-50">Token</label>
                <textarea id="jwtToken" class="form-control mono" rows="4" placeholder="Bearer token..." spellcheck="false"></textarea>
                <div class="d-flex align-items-center justify-content-between mt-2">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="useToken" checked />
                    <label class="form-check-label small text-white-50" for="useToken">Usar token automaticamente</label>
                  </div>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-light" type="button" id="copyToken">
                      <i class="bi bi-clipboard"></i>
                      Copiar
                    </button>
                    <button class="btn btn-sm btn-outline-danger" type="button" id="clearToken">
                      <i class="bi bi-trash3"></i>
                      Limpar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card card-glass mt-4">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between">
                <h6 class="mb-0">Presets (API)</h6>
                <span class="small text-white-50">1 clique</span>
              </div>
              <div class="mt-3">
                <label class="form-label small text-white-50">Escolha um endpoint</label>
                <select class="form-select" id="presetSelect"></select>
              </div>
              <div class="mt-3 d-grid gap-2">
                <button class="btn btn-outline-light" type="button" id="applyPreset">
                  <i class="bi bi-magic"></i>
                  Aplicar preset
                </button>
                <button class="btn btn-outline-light" type="button" id="applyPresetAndSend">
                  <i class="bi bi-send"></i>
                  Aplicar e enviar
                </button>
              </div>
              <div class="form-text text-white-50 mt-2">
                Rotas protegidas exigem <span class="mono">Authorization: Bearer &lt;token&gt;</span>.
              </div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="card card-glass">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <h6 class="mb-0">Request Builder</h6>
                <div class="d-flex align-items-center gap-2">
                  <button class="btn btn-sm btn-outline-light" type="button" id="beautifyJson" title="Formatar JSON do body">
                    <i class="bi bi-braces"></i>
                    Formatar
                  </button>
                  <button class="btn btn-sm btn-outline-light" type="button" id="clearBody">
                    <i class="bi bi-eraser"></i>
                    Limpar body
                  </button>
                </div>
              </div>

              <div class="row g-3 mt-1 align-items-end">
                <div class="col-12 col-md-3">
                  <label class="form-label small text-white-50">Método</label>
                  <select class="form-select mono" id="method">
                    <option>GET</option>
                    <option>POST</option>
                    <option>PUT</option>
                    <option>DELETE</option>
                  </select>
                </div>
                <div class="col-12 col-md-9">
                  <label class="form-label small text-white-50">Path (relativo à Base URL)</label>
                  <div class="input-group">
                    <span class="input-group-text mono">/</span>
                    <input class="form-control mono" id="path" type="text" placeholder="eventos" />
                    <button class="btn btn-success" id="sendReq" type="button">
                      <i class="bi bi-send"></i>
                      Enviar
                    </button>
                  </div>
                  <div class="form-text text-white-50">Ex.: <span class="mono">eventos</span>, <span class="mono">eventos/1/dashboard</span></div>
                </div>
              </div>

              <div class="mt-3">
                <label class="form-label small text-white-50">Headers (opcional)</label>
                <textarea class="form-control mono" id="headers" rows="3" spellcheck="false" placeholder='{"Content-Type":"application/json"}'></textarea>
              </div>

              <div class="mt-3">
                <label class="form-label small text-white-50">Body (JSON)</label>
                <textarea class="form-control mono" id="body" rows="10" spellcheck="false" placeholder='{"exemplo":"valor"}'></textarea>
              </div>
            </div>
          </div>

          <div class="card card-glass mt-4">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <h6 class="mb-0">Resposta</h6>
                <div class="d-flex align-items-center gap-2">
                  <span class="badge badge-soft mono" id="respMeta">—</span>
                  <button class="btn btn-sm btn-outline-light" type="button" id="copyResponse">
                    <i class="bi bi-clipboard"></i>
                    Copiar
                  </button>
                  <button class="btn btn-sm btn-outline-danger" type="button" id="clearResponse">
                    <i class="bi bi-trash3"></i>
                    Limpar
                  </button>
                </div>
              </div>

              <div class="mt-3">
                <div class="response-box mono" id="responseBox">Envie uma requisição para ver a resposta aqui.</div>
              </div>

              <div class="mt-4">
                <div class="d-flex align-items-center justify-content-between">
                  <h6 class="mb-0">Histórico (local)</h6>
                  <button class="btn btn-sm btn-outline-danger" type="button" id="clearHistory">
                    <i class="bi bi-x-circle"></i>
                    Limpar histórico
                  </button>
                </div>
                <div class="mt-2" id="history"></div>
              </div>
            </div>
          </div>

          <div class="text-center text-white-50 small mt-4">
            Feito para facilitar seus testes • <span class="mono">/ui</span>
          </div>
        </div>
      </div>
    </main>

    <script>
      window.__APP__ = <%- JSON.stringify({ apiBaseHint }) %>;
    </script>
    <script src="/public/ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>


